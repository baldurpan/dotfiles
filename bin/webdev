#!/bin/bash

# Ask for the administrator password upfront
sudo -v

# Keep-alive: update existing `sudo` time stamp until `.osx` has finished
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &

spinner() {
	local msg="$1"
	local pid=$2
	local delay=0.15
	local spinstr='|/-\'
	while [ "$(ps a | awk '{print $1}' | grep $pid)" ]; do
		local temp=${spinstr#?}
		printf "$msg %c " "$spinstr"
		local spinstr=$temp${spinstr%"$temp"}
		sleep $delay
		printf "\r"
	done
	printf  "$msg \e[0;32mDONE\e[00m\n"
}

if [ -z "$2" ]; then

	if [ "$1" == "start" ]; then
		brew services start mysql
		sudo brew services start memcached
		brew services start php70
		sudo brew services start nginx
		sudo brew services start dnsmasq
	elif [ "$1" == "stop" ]; then
		brew services stop mysql
		sudo brew services stop memcached
		brew services stop php70
		sudo brew services stop nginx
		sudo brew services stop dnsmasq
	elif [ "$1" == "restart" ]; then
		brew services restart mysql
		sudo brew services restart memcached
		brew services restart php70
		sudo brew services restart nginx
		sudo brew services restart dnsmasq
	fi

elif [ "$1" == "start" ] || [ "$1" == "stop" ] || [ "$1" == "restart" ]; then
	brew services $1 $2
fi
